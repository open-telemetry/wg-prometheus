extensions:
  clb_config_manager:
    http:
      endpoint: 0.0.0.0:8520
    grpc:
      endpoint: 0.0.0.0:8521
    targets_base_dir: /etc/clb
receivers:
  otlp:
    protocols:
      grpc:
        endpoint: localhost:4317
      http:
        endpoint: localhost:55681
  prometheus:
    config:
      scrape_configs:
        - job_name: static
          static_configs:
            - targets: [ 'localhost:8888' ] # self metric
              labels:
                foo: bar
        - job_name: apps
          kubernetes_sd_configs:
            - role: pod
              namespaces:
                names:
                  - default
                  - kube-system
          relabel_configs:
            # scrape pods annotated with "prometheus.io/scrape: true"
            - source_labels: [ __meta_kubernetes_pod_annotation_prometheus_io_scrape ]
              regex: "true"
              action: keep
            # read the port from "prometheus.io/port: <port>" annotation and update scraping address accordingly
            - source_labels: [ __address__, __meta_kubernetes_pod_annotation_prometheus_io_port ]
              action: replace
              target_label: __address__
              regex: ([^:]+)(?::\d+)?;(\d+)
              # escaped $1:$2
              replacement: $$1:$$2
            - source_labels: [ __meta_kubernetes_namespace ]
              action: replace
              target_label: kubernetes_namespace
            - source_labels: [ __meta_kubernetes_pod_name ]
              action: replace
              target_label: kubernetes_pod_name

processors:
  batch:
    timeout: 60s
exporters:
  awsemf:
    log_group_name: "CWAgentHackathon"
    namespace: "AutoSharding"
    dimension_rollup_option: "NoDimensionRollup"
service:
  pipelines:
    metrics:
      receivers: [ otlp, prometheus ]
      exporters: [ awsemf ]